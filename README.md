# BraTS Post-treatment

**For detailed setup instruction, go to: [Usage Guide Document](docs/usage_guide.md)**

## Setup

Create and activate the Python environment (already configured in `.venv/`):

```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
pip install -r requirements.txt
```

## Statistics Inspector

Interactive web application for analyzing BraTS case and dataset statistics:

```powershell
python scripts/analyze_statistics.py --open-browser
```

**Features:**

- **Case Statistics Tab**: View intensity histograms and segmentation label volumes for individual cases
- **Dataset Statistics Tab**: Analyze aggregate metrics across entire datasets (shapes, spacings, modalities, intensity summaries, label counts)
- **Smart Caching**: Dataset statistics are pre-computed and cached in `outputs/statistics_cache/`
- **Recompute Option**: Refresh statistics when data changes with a single click

The statistics inspector replaces the previous `generate_case_statistics.py` and `summarize_brats_dataset.py` scripts with a unified browser-based interface.

## Unified Visualization Tool

A single comprehensive tool for all BraTS volume visualization needs with three distinct modes:

### Interactive Mode (Dash Web App)

Launch a browser-based app for real-time slice browsing with segmentation overlays:

```powershell
python scripts/visualize_volumes.py --mode interactive --open-browser
```

Key features: dataset/case dropdowns, modality-aware axis slider, segmentation toggles, orthogonal previews, and one-click PNG export. Toggle between Standard, High (2×), or Best (4×) display quality. View all modalities side-by-side in grid mode.

### Static Mode (Publication Figures)

Generate multi-modal panels or orthogonal planes with segmentation overlays:

```powershell
python scripts/visualize_volumes.py --mode static \
    --case-dir training_data_additional/BraTS-GLI-02405-100 \
    --layout modalities --axis axial --fraction 0.55 \
    --output outputs/BraTS-GLI-02405-100_axial.png
```

Orthogonal views for a single modality:

```powershell
python scripts/visualize_volumes.py --mode static \
    --case-dir training_data_additional/BraTS-GLI-02405-100 \
    --layout orthogonal --modality t1c --indices 90 110 70 \
    --output outputs/BraTS-GLI-02405-100_orthogonal.png
```

**Options:**
- `--layout`: `modalities` or `orthogonal`
- `--axis`: axis for modalities layout (`axial`, `coronal`, `sagittal`)
- `--fraction` / `--index`: control slice location
- `--indices`: specify slice indices for orthogonal layout
- `--no-overlay`: disable segmentation overlay
- `--show`: open interactive matplotlib window

### GIF Mode (Animations)

Create slice-by-slice animations for review meetings:

```powershell
python scripts/visualize_volumes.py --mode gif \
    --root training_data_additional --output-dir outputs/gifs \
    --gif-modality t2f --gif-axis axial --step 3 --overlay --max-cases 2
```

GIFs are written to `outputs/gifs/CASE_modality_axis.gif`.

**Note:** The previous separate scripts (`launch_volume_inspector.py`, `visualize_brats.py`, `generate_case_gifs.py`) have been consolidated into this unified tool and moved to `scripts/deprecated/`.

## Outputs directory

Figures and JSON reports are written to the `outputs/` folder (created on demand).
Common subdirectories include:

- `outputs/gifs/` — animated slice reels.
- `outputs/statistics_cache/` — cached dataset-wide statistics.
- `outputs/volumes/` — Plotly HTML viewers generated by `precompute_volume_visuals.py`.
