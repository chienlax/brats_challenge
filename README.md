# BraTS Post-treatment

**For detailed setup instruction, go to: ![alt text](docs/usage_guide.md)**

## Setup

Create and activate the Python environment (already configured in `.venv/`):

```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
pip install -r requirements.txt
```

## Dataset summary

Generate global statistics and (optionally) save them to JSON:

```powershell
python scripts/summarize_brats_dataset.py --root training_data_additional --output outputs/dataset_stats.json
```

Key metrics include:

- Number of cases processed.
- Shape / voxel-spacing consistency.
- Intensity percentiles per modality.
- Label frequencies across segmentation masks.
- Modalities present / missing per case.

## Visualization script

Render multi-modal panels or orthogonal planes with segmentation overlays:

```powershell
python scripts/visualize_brats.py --case-dir training_data_additional/BraTS-GLI-02405-100 --layout modalities --axis axial --fraction 0.55 --output outputs/BraTS-GLI-02405-100_axial.png
```

Alternative example showing orthogonal views for a single modality:

```powershell
python scripts/visualize_brats.py --case-dir training_data_additional/BraTS-GLI-02405-100 --layout orthogonal --modality t1c --indices 90 110 70 --output outputs/BraTS-GLI-02405-100_orthogonal.png
```

### Options

- `--layout`: `modalities` (default) or `orthogonal`.
- `--axis`: axis for `modalities` layout (`axial`, `coronal`, `sagittal`).
- `--fraction` / `--index`: control slice location.
- `--indices`: specify slice indices for orthogonal layout.
- `--no-overlay`: disable segmentation overlay.
- `--show`: open an interactive matplotlib window in addition to saving the figure.

Outputs are saved under the provided `--output` path; if omitted, the figure is
shown interactively.

## Per-case histogram statistics

Produce modality histograms and segmentation volume tables for each subject:

```powershell
python scripts/generate_case_statistics.py --root training_data_additional --output-dir outputs/stats --max-cases 5
```

Each case gets a histogram PNG plus an entry in `case_statistics.json` with voxel counts and percentages per label.

## Batch GIF generation

Create slice-by-slice animations for review meetings (segmentation overlay optional):

```powershell
python scripts/generate_case_gifs.py --root training_data_additional --output-dir outputs/gifs --modality t2f --axis axial --step 3 --overlay --max-cases 2
```

GIFs are written to `outputs/gifs/CASE_modality_axis.gif`.

## Interactive volume inspector

Launch a Dash-powered browser app for real-time slice browsing and overlays:

```powershell
python scripts/launch_volume_inspector.py --open-browser
```

Key features: dataset/case dropdowns, modality-aware axis slider, segmentation toggles, orthogonal previews, and one-click PNG export of the active slice.
Use the display quality toggle to switch to a 2× upscale when you need sharper views or exports.
Flip the view mode to “All modalities” to inspect T1c/T1n/T2w/T2f slices side-by-side while keeping overlays intact.

## Interactive notebook

Launch Jupyter and open `notebooks/brats_exploration.ipynb` for widgets that enable slice
browsing, orientation checks, histogram analytics, and GIF generation helpers.

## Outputs directory

Figures and JSON reports are written to the `outputs/` folder (created on demand).
Common subdirectories include:

- `outputs/gifs/` — animated slice reels.
- `outputs/stats/` — histogram PNGs plus per-case metrics.
- `outputs/volumes/` — Plotly HTML viewers generated by `precompute_volume_visuals.py`.
